<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Trash Classifier</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.9.0/dist/tf.min.js"></script>
    <style>
        /* Custom hover animation for buttons */
        .glow-button {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            background-color: #22c55e; /* Light green */
        }
        .glow-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.5);
        }
        .glow-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.2),
                transparent
            );
            transition: 0.5s;
        }
        .glow-button:hover::before {
            left: 100%;
        }
        /* File input styling */
        .file-input::-webkit-file-upload-button {
            @apply text-white px-4 py-2 rounded-lg glow-button;
            background-color: #22c55e;
        }
        .file-input:dark::-webkit-file-upload-button {
            @apply text-gray-200;
            background-color: #16a34a;
        }
        /* Eco-friendly color scheme */
        body {
            background-color: #111827; /* Dark gray-black */
        }
        .dark body {
            background-color: #f3f4f6; /* Light gray for light mode */
        }
        .container-bg {
            background-color: #1f2937; /* Darker gray for container */
            position: relative; /* For positioning beta label */
        }
        .dark .container-bg {
            background-color: #ffffff; /* White for light mode */
        }
        /* Slider styling */
        .slider-container {
            width: 60px;
            height: 30px;
            background-color: #374151; /* Dark gray */
            border-radius: 9999px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .dark .slider-container {
            background-color: #d1d5db; /* Light gray */
        }
        .slider {
            width: 26px;
            height: 26px;
            background-color: #22c55e; /* Light green */
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: transform 0.3s ease;
        }
        .dark .slider {
            transform: translateX(30px);
        }
        /* Rounded squares */
        .rounded-square {
            width: 100%;
            height: 16rem;
            border-radius: 1.5rem;
            border: 2px solid #6b7280;
        }
        .dark .rounded-square {
            border-color: #d1d5db;
        }
        /* Beta label */
        .beta-label {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #22c55e;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        /* Recycling tips styling */
        .recycling-tips {
            max-width: 100%;
            overflow-y: auto;
            max-height: 100px;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center transition-colors duration-300">
    <div class="w-full max-w-5xl mx-4 p-6 container-bg rounded-lg shadow-lg flex flex-col items-center">
        <!-- Beta Label -->
        <div class="beta-label">Beta</div>
        <!-- Title -->
        <h1 class="text-3xl font-bold text-center text-gray-100 dark:text-gray-800 mb-4">RecycleRight Classifier</h1>
        <!-- Description -->
        <p class="text-center text-gray-400 dark:text-gray-600 mb-6">Upload an image to identify recyclable materials and get recycling tips</p>

        <!-- Main Content: Two Rounded Squares -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-4xl mb-6">
            <!-- Left: Image Upload -->
            <div class="rounded-square flex flex-col items-center justify-center p-4">
                <label for="image-upload" class="w-full h-full flex items-center justify-center border-2 border-dashed border-gray-500 dark:border-gray-300 rounded-lg cursor-pointer hover:border-green-400 dark:hover:border-green-500 transition-colors">
                    <input type="file" accept="image/*" id="image-upload" class="hidden" onchange="previewImage(event)" />
                    <span id="upload-text" class="text-gray-400 dark:text-gray-600 text-center">Drag and drop or click to upload</span>
                </label>
                <div id="image-preview" class="mt-4 hidden">
                    <img id="preview-img" class="max-w-full max-h-40 rounded-lg" alt="Image Preview" />
                </div>
            </div>

            <!-- Right: Results -->
            <div class="rounded-square flex flex-col items-center justify-center p-4">
                <div id="output" class="text-center w-full">
                    <div id="result" class="text-lg font-semibold text-green-400 dark:text-green-600 mb-2">Awaiting Classification</div>
                    <div id="recycling-tips" class="text-gray-300 dark:text-gray-600 recycling-tips"></div>
                </div>
            </div>
        </div>

        <!-- Classify Button -->
        <div class="flex justify-center mb-6">
            <button id="classify-btn" class="glow-button text-white px-8 py-3 rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed" disabled>Classify</button>
        </div>

        <!-- Settings Slider -->
        <div class="flex flex-col items-center">
            <span class="text-gray-400 dark:text-gray-600 mb-2">Theme</span>
            <div id="theme-toggle" class="slider-container">
                <div class="slider"></div>
            </div>
        </div>
    </div>

    <script>
        const MODEL_URL = 'https://jonashruda.github.io/trash-detector-ai/model.json';

        let model;
        const labels = ["Cardboard", "Paper", "metal", "Glass", "Plastic", "Trash"];

        const recyclingTips = {
            Cardboard: [
                "Flatten cardboard boxes to save space in recycling bins.",
                "Remove any tape, staples, or non-cardboard materials.",
                "Keep cardboard dry and clean; avoid recycling greasy or food-contaminated items."
            ],
            Paper: [
                "Recycle clean paper like office paper, newspapers, and magazines.",
                "Remove plastic coatings, bindings, or food residue before recycling.",
                "Check local guidelines, as some areas don't accept certain papers like laminated sheets."
            ],
            metal: [
                "Recycle aluminum cans, tin cans, and foil after rinsing off food residue.",
                "Remove non-metal parts like plastic lids if required by your local program.",
                "Crush cans to save space, but check if your facility prefers them uncrushed."
            ],
            Glass: [
                "Rinse glass bottles and jars to remove food or liquid residue.",
                "Remove metal lids or corks and recycle them separately if required.",
                "Check local rules, as some areas only accept certain colors of glass."
            ],
            Plastic: [
                "Recycle plastics marked with recycling symbols 1-7, but check local guidelines.",
                "Rinse containers and remove non-plastic parts like pumps or caps if needed.",
                "Avoid recycling plastic bags in curbside bins; use designated drop-off locations."
            ],
            Trash: [
                "Non-recyclable items like food waste or soiled materials should go in the trash.",
                "Consider composting organic waste if available in your area.",
                "Reduce waste by choosing reusable items over single-use products."
            ]
        };

        const imageUpload = document.getElementById('image-upload');
        const previewImg = document.getElementById('preview-img');
        const imagePreview = document.getElementById('image-preview');
        const uploadText = document.getElementById('upload-text');
        const classifyBtn = document.getElementById('classify-btn');
        const resultDiv = document.getElementById('result');
        const recyclingTipsDiv = document.getElementById('recycling-tips');

        async function loadModel() {
            resultDiv.textContent = 'Loading model... Please wait.';
            try {
                model = await tf.loadLayersModel(MODEL_URL);
                resultDiv.textContent = 'Model loaded. Upload an image to classify.';
            } catch (err) {
                resultDiv.textContent = 'Failed to load model.';
                console.error(err);
            }
        }

        function preprocessImage(imgElement) {
            const tensor = tf.browser.fromPixels(imgElement)
                .resizeNearestNeighbor([224, 224])
                .toFloat()
                .expandDims(0)
                .div(255);
            return tensor;
        }

        async function classifyImage() {
            if (!model) {
                alert('Model not loaded yet!');
                return;
            }
            resultDiv.textContent = 'Classifying...';
            recyclingTipsDiv.innerHTML = '';

            const inputTensor = preprocessImage(previewImg);
            const prediction = await model.predict(inputTensor).data();
            inputTensor.dispose();

            const results = Array.from(prediction)
                .map((confidence, i) => ({ label: labels[i], confidence }))
                .sort((a, b) => b.confidence - a.confidence);

            const topResult = results[0];
            const displayLabel = topResult.label.charAt(0).toUpperCase() + topResult.label.slice(1);

            resultDiv.textContent = `${displayLabel} (${(topResult.confidence * 100).toFixed(2)}% sure)`;

            // Display recycling tips
            const tips = recyclingTips[topResult.label] || ["No specific recycling tips available."];
            recyclingTipsDiv.innerHTML = `
                <div class="text-left">
                    <p class="font-semibold mb-1">How to Recycle ${displayLabel}:</p>
                    <ul class="list-disc list-inside text-sm">
                        ${tips.map(tip => `<li>${tip}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        imageUpload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                previewImg.src = e.target.result;
                imagePreview.classList.remove('hidden');
                uploadText.textContent = file.name;
                classifyBtn.disabled = false;
                resultDiv.textContent = 'Ready to classify.';
                recyclingTipsDiv.innerHTML = '';
            };
            reader.readAsDataURL(file);
        });

        classifyBtn.addEventListener('click', classifyImage);

        // Theme toggle
        const toggleSlider = document.getElementById('theme-toggle');
        toggleSlider.addEventListener('click', () => {
            document.body.classList.toggle('dark');
        });

        loadModel();
    </script>
</body>
</html>
