<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Trash Detector AI</title>

<!-- Google font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>

<style>
  :root{
    --bg:#f6f7fb;
    --card:#ffffff;
    --muted:#6b7280;
    --accent:#16a34a; /* green */
    --accent-2:#f59e0b; /* orange */
    --danger:#ef4444; /* red */
    --glass: rgba(255,255,255,0.6);
    --radius:14px;
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background: linear-gradient(180deg,#eef2ff 0%, var(--bg) 60%);
    padding:32px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:16px;
  }
  .wrapper{
    width:100%;
    max-width:980px;
    background:var(--card);
    border-radius:20px;
    box-shadow: 0 8px 30px rgba(16,24,40,0.08);
    padding:28px;
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:22px;
  }
  header{
    grid-column:1 / -1;
    display:flex;
    align-items:center;
    justify-content:space-between;
  }
  .brand{display:flex;gap:14px;align-items:center;}
  .logo{
    width:56px;height:56px;border-radius:12px;
    background:linear-gradient(135deg,#10b981,#34d399);
    color:white;display:grid;place-items:center;
    font-weight:700;font-size:20px;
  }
  h1{margin:0;font-size:20px}
  p.lead{margin:0;color:var(--muted); font-size:14px}

  .upload{
    border: 1px dashed rgba(15,23,42,0.06);
    border-radius:12px;
    padding:18px;text-align:center;
    transition:all .18s ease;
  }
  .upload.dragover{
    border-color: var(--accent);
    transform:translateY(-2px);
    box-shadow: 0 8px 30px rgba(16,185,129,0.08);
  }
  .upload input[type=file]{display:none}
  .upload .hint{color:var(--muted); margin-top:8px; font-size:14px}
  .btn{
    padding:10px 16px;
    background:linear-gradient(90deg,#0369a1,#0ea5e9);
    color:white;border-radius:10px;
    cursor:pointer;border:0;font-weight:600;
    margin-top:12px;
  }
  .preview-wrap{display:flex;flex-direction:column;gap:14px;}
  .preview{
    background:var(--glass);border-radius:12px;
    padding:8px;min-height:220px;
    display:grid;place-items:center;overflow:hidden;
  }
  .preview img{
    max-width:100%;max-height:100%;
    border-radius:10px;object-fit:contain;
  }
  .meta{display:flex;justify-content:space-between;align-items:center;}
  .controls{display:flex;gap:10px;align-items:center;}
  .classify{
    padding:10px 14px;background:#0f172a;color:white;
    border-radius:10px;border:0;cursor:pointer;font-weight:600;
  }
  .classify[disabled]{opacity:.5;cursor:default}

  .result-card{
    background:white;border-radius:14px;
    padding:18px;box-shadow: 0 8px 30px rgba(2,6,23,0.04);
  }
  .result-header{display:flex;gap:12px;align-items:center}
  .result-icon{
    width:52px;height:52px;border-radius:12px;
    display:grid;place-items:center;font-weight:700;color:white;
    font-size:24px;
  }
  .result-sub{color:var(--muted);margin-top:6px;font-size:13px}
  .tips{margin-top:12px;font-size:13px;color:var(--muted)}

  .spinner{
    border:3px solid rgba(15,23,42,0.08);
    border-top:3px solid rgba(15,23,42,0.6);
    border-radius:50%;width:18px;height:18px;
    animation:spin 1s linear infinite;
  }
  @keyframes spin{to{transform:rotate(360deg)}}

  @media (max-width:880px){
    .wrapper{grid-template-columns:1fr; padding:18px}
    .result-card{order:3}
  }
</style>
</head>
<body>
<main class="wrapper">
  <header>
    <div class="brand">
      <div class="logo">TD</div>
      <div>
        <h1>Trash Detector AI</h1>
        <p class="lead">Upload a photo to check recyclability.</p>
      </div>
    </div>
    <div style="color:var(--muted);font-size:13px">Beta</div>
  </header>

  <!-- Upload -->
  <section>
    <label id="uploadLabel" class="upload" for="fileInput">
      <input id="fileInput" type="file" accept="image/*" />
      <div>
        <strong>Drag & drop an image</strong>
        <div class="hint">or click to choose</div>
      </div>
    </label>
    <div style="height:14px"></div>
    <div class="preview-wrap">
      <div class="preview" id="preview">
        <div id="previewEmpty" style="color:var(--muted)">No image selected</div>
        <img id="previewImg" src="" alt="" style="display:none" />
      </div>
      <div class="meta">
        <div style="font-size:13px;color:var(--muted)" id="fileMeta">No file</div>
        <div class="controls">
          <button id="clearBtn" class="btn" style="background:#efefef;color:#0f172a;display:none">Clear</button>
          <button id="classifyBtn" class="classify" disabled>Classify</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Result -->
  <aside>
    <div class="result-card" id="resultCard">
      <div class="result-header">
        <div id="resultIcon" class="result-icon" style="background:var(--accent)">✓</div>
        <div>
          <div id="resultTitle" style="font-weight:700">Awaiting image</div>
          <div id="resultSubtitle" class="result-sub">Upload an image to classify.</div>
        </div>
      </div>
      <div class="tips" id="resultTips">Tip: Clear background improves accuracy.</div>
    </div>
  </aside>
</main>

<script>
const fileInput = document.getElementById('fileInput');
const previewImg = document.getElementById('previewImg');
const previewEmpty = document.getElementById('previewEmpty');
const fileMeta = document.getElementById('fileMeta');
const classifyBtn = document.getElementById('classifyBtn');
const clearBtn = document.getElementById('clearBtn');

const resultIcon = document.getElementById('resultIcon');
const resultTitle = document.getElementById('resultTitle');
const resultSubtitle = document.getElementById('resultSubtitle');
const resultTips = document.getElementById('resultTips');

let currentFile = null;
let model = null;

async function loadModel(){
  model = await tf.loadLayersModel('https://jonashruda.github.io/trash-detector-ai/model.json');
  console.log("Model loaded");
}
loadModel();

function clearSelection(){
  currentFile = null;
  previewImg.style.display = 'none';
  previewEmpty.style.display = 'block';
  fileMeta.textContent = 'No file';
  classifyBtn.disabled = true;
  clearBtn.style.display = 'none';
  resultTitle.textContent = 'Awaiting image';
  resultSubtitle.textContent = 'Upload an image to classify.';
  resultTips.textContent = 'Tip: Clear background improves accuracy.';
}

function handleFile(file){
  if (!file || !file.type.startsWith('image/')) return;
  currentFile = file;
  const url = URL.createObjectURL(file);
  previewImg.src = url;
  previewImg.style.display = 'block';
  previewEmpty.style.display = 'none';
  fileMeta.textContent = `${file.name} • ${(file.size/1024|0)} KB`;
  classifyBtn.disabled = false;
  clearBtn.style.display = 'inline-block';
}

fileInput.addEventListener('change', e => handleFile(fileInput.files[0]));
clearBtn.addEventListener('click', clearSelection);

classifyBtn.addEventListener('click', async () => {
  if (!currentFile || !model) return;
  classifyBtn.innerHTML = '<div class="spinner"></div>';
  classifyBtn.disabled = true;

  const img = document.createElement('img');
  img.src = URL.createObjectURL(currentFile);
  await new Promise(res => img.onload = res);

  const tensor = tf.browser.fromPixels(img)
    .resizeNearestNeighbor([224, 224])
    .toFloat()
    .expandDims();
  const prediction = model.predict(tensor);
  const data = await prediction.data();
  tensor.dispose();
  prediction.dispose();

  // Example mapping - adjust labels if different
  const labels = ['Recyclable', 'Non-recyclable', 'Unknown'];
  const maxIdx = data.indexOf(Math.max(...data));
  const confidence = (data[maxIdx] * 100).toFixed(1);

  resultTitle.textContent = labels[maxIdx];
  resultSubtitle.textContent = `Confidence: ${confidence}%`;

  if (maxIdx === 0){
    resultIcon.style.background = 'var(--accent)';
    resultIcon.textContent = '✓';
    resultTips.textContent = 'This item is likely recyclable. Clean it before disposal.';
  } else if (maxIdx === 1){
    resultIcon.style.background = 'var(--danger)';
    resultIcon.textContent = '✗';
    resultTips.textContent = 'This item is likely not recyclable. Use general waste.';
  } else {
    resultIcon.style.background = 'var(--accent-2)';
    resultIcon.textContent = '?';
    resultTips.textContent = 'Uncertain — try a clearer image.';
  }

  classifyBtn.textContent = 'Classify';
  classifyBtn.disabled = false;
});
</script>
</body>
</html>
